{% extends 'base.html' %}
{% block content %}

{% load filters %}

<h1>Users</h1>

<div>
  <label>
    Filter <br>
    <input type="text" id="user-filter-input" oninput="filter_users()">
  </label>
</div>

<div>
  <a href="{% url 'all-users-csv' %}" download>Download All</a>
</div>

<table id="user-table">
  <thead>
    <tr>
      <td>Last Name</td>
      <td>First Name</td>
      <td>Email</td>
      <td>Membership Type</td>
      <td>Membership Expires</td>
    </tr>
  </thead>
  <tbody>
    {% for user in object_list %}
    <tr
      class="user-row {% if not user.subscription_is_current %}subscription-not-current{% endif %}"
      onclick="window.location = '{% url 'user-profile' pk=user.pk %}'"
    >
      <td>{{user.last_name}}</td>
      <td>{{user.first_name}}</td>
      <td>{{user.username}}</td>

      {% if user.subscription is not None %}
      <td>{{user.subscription.membership_type}}</td>
      <td>
        {% format_datetime user.subscription.valid_until none_ok=True %}
      </td>
      {% else %}
      <td></td>
      <td></td>
      {% endif %}
    </tr>
    {% endfor %}
  </tbody>
</table>

<style>
  #user-table {
    border-collapse: collapse;
  }

  #user-table thead {
    font-weight: bold;
  }

  #user-table td, #user-table th {
    border: 1px solid lightgray;
  }

  #user-table td {
    padding: .125rem 1rem .125 .25rem;
  }

  .user-row:hover {
    cursor: pointer;
    background-color: lightcyan;
  }

</style>

<script>
function filter_users() {
  let filter_str = $('#user-filter-input').val().trim().toLowerCase();
  console.log(filter_str)
  $('#user-table tbody tr').filter(function() {
    // Adapted from https://www.w3schools.com/jquery/jquery_filters.asp
    let include = $(this).text().toLocaleLowerCase().indexOf(filter_str) > -1;
    $(this).toggle(include);
  });
}
</script>

{% endblock %}
